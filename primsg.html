<!DOCTYPE html>
<html>
<head>
	<title>Private Show</title>
	<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
	<link href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
	<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
	<script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	<script src="https://cdn.bootcss.com/marked/0.4.0/marked.js"></script>
	<link href="https://cdn.bootcss.com/highlight.js/9.12.0/styles/agate.min.css" rel="stylesheet">
	<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
	<script src="lib/api.js"></script>
	<script src="confplus.js"></script>
	<script src="lib/apiplus.js"></script>
	<script src="lib/jsencrypt.min.js"></script>
	<style type="text/css">
		 body{

		   background:url(lib/back.jpg)  no-repeat center center;

		   background-size:cover;

		   background-attachment:fixed;

		}
		.top-buffer{
			margin-top:200px;
		}
	</style>
</head>
<body>
	<div class="container">
		<div class="row top-buffer">
			<div class="col-sm-9 column">
				<div class="panel panel-primary">
					<div class="panel-heading">
						<h3 class="panel-title">查看私信</h3>
					</div>
					<div class="panel-body">
						<div id="show"></div>
						<button type="button" id="more" onclick="moremsg()" class="btn btn-default btn-lg btn-block">加载更多...</button>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- 模态框（Modal） -->
	<div class="modal fade" id="priModal" tabindex="-1" role="dialog" aria-labelledby="priModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
						&times;
					</button>
					<h4 class="modal-title" id="priModalLabel">
						请输入私钥
					</h4>
				</div>
				<div class="modal-body">
					<textarea id="priKey" class="form-control" rows="3"  style="resize:none" placeholder="如果不输入私钥您只能看到加密后的内容！"></textarea>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">关闭
					</button>
					<button type="button" onclick="decodeRsa()" class="btn btn-primary">
						查看
					</button>
				</div>
			</div><!-- /.modal-content -->
		</div><!-- /.modal -->
	</div>
<script type="text/javascript">
	$('#priModal').modal('show')
	var issue=null
	var curPage=0
	var decrypt = new JSEncrypt();
	function decodeRsa(){
		decrypt.setPrivateKey($("#priKey").val());
		issue=getIssue(repo,priMsgTitle)
		if(issue){ // 存在私信
			moremsg()
		}else{
			$("#more").hide()
		}
		$('#priModal').modal('hide')
	}
	// 面板上添加新内容
	function newComs(comment,dom){
		if(comment==null){
			return
		}
		var updated_at = new Date(comment.updated_at).toLocaleString();
		var body = decrypt.decrypt(comment.body);
		var commentHtml = '<div class="media"><div class="media-body"><h4 class="media-heading">'+updated_at+'</h4><h6></h6>'+body+'</div></div><h2></h2>';
		var new_obj = $(commentHtml);
		dom.append(new_obj);
	}
	function moremsg(){
		curPage++
		// 获取评论数据
		if(issue){
			msglist=getComments(issue.comments_url,curPage,pageSizeMsg)
			for(var i=0;i<msglist.length;i++){
				newComs(msglist[i],$("#show"))
			}
			if(msglist.length!=pageSizeMsg){
				$("#more").hide()
			}
		}
	}
</script>
</body>
</html>